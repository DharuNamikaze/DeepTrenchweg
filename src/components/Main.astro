---
import "../pages/_ocean.css";
import { mlConcepts, depthMarkers, zones } from "../data/mlconcepts.js";

// determine sizes for images
function getImageSize(size: string) {
  if (size === "large") return { width: 98, height: 98 };
  if (size === "medium") return { width: 58, height: 58 };
  return { width: 40, height: 40 }; // small
}

---

<main>
  <!-- Hero -->
  <section class="hero-section">
    <div class="title-container">
      <h1>The Deep Trench</h1>
      <h2>
        by
        <span>
          <a
            class="hover:underline"
            href="https://abinesh-mathivanan.vercel.app/"
            target="_blank"
            rel="noopener">Beens</a
          >
        </span>
        &
        <span>
          <a
            class="hover:underline"
            href="https://dharuportfolio.netlify.app/"
            target="_blank"
            rel="noopener">Nami</a
          >
        </span>
      </h2>
    </div>
  </section>

  <div class="wave-border"></div>

  <section class="ocean-section">
    <div class="ocean-container">
      <!-- Zone Labels -->
      {
        zones.map((zone) => (
          <div class="zone-label" style={`top: ${zone.start + 100}px;`}>
            {zone.name}
          </div>
        ))
      }

      <!-- Depth Markers -->
      {
        depthMarkers.map((depth) => (
          <span class="depth-marker" style={`top: ${depth}px;`}>
            {depth}m
          </span>
        ))
      }

      <!-- ML Concepts -->
      {
        mlConcepts.map((concept, index) => {
          const { width, height } = getImageSize(concept.size);

          return (
            <div
              class={`ml-concept ${concept.size}`}
              style={`top: ${concept.depth}px;`}
              data-name={concept.name}
              data-depth={String(concept.depth)}
            >
              <div class="concept-image-container">
                <img
                  src={concept.image}
                  alt={concept.name}
                  width={width}
                  height={height}
                  loading={index < 5 ? "eager" : "lazy"}
                  decoding="async"
                  class="concept-image rounded-lg"
                />
              </div>

              <div class="concept-info">
                <h3>{concept.name}</h3>
                <p>{concept.description}</p>
                <span class="concept-category">{concept.category}</span>
              </div>
            </div>
          );
        })
      }
    </div>
  </section>
</main>

<script>
  // Intersection Observer animations
  const concepts = document.querySelectorAll(".ml-concept");

  const conceptObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    },
    { threshold: 0.1, rootMargin: "100px" }
  );

  concepts.forEach((concept) => conceptObserver.observe(concept));

  // Optional click logger
  concepts.forEach((concept) => {
    concept.addEventListener("click", () => {
      const el = concept as HTMLElement;
      console.log(`Clicked: ${el.dataset.name} at depth ${el.dataset.depth}m`);
    });
  });
</script>
